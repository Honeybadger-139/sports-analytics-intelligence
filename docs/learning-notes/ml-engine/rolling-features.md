# Learning Note: Rolling Features & Team Momentum

## What is it?
Rolling features (also known as "moving averages" or "sliding window features") are metrics calculated over a fixed number of previous events. In sports analytics, this means looking at a team's performance over their last 5, 10, or 20 games rather than just their most recent game or their season-long average.

## Why does it matter?
1. **Captures Momentum**: A team's season-long win% might be 50%, but they might have won 4 of their last 5. Rolling features capture this "hot streak" which is more predictive of the next game than the season average.
2. **Handles Non-Stationarity**: Team quality changes over time (injuries, trades, coaching changes). Statistics from 4 months ago are less relevant than statistics from 2 weeks ago.
3. **Smooths Noise**: A single game can be an outlier (e.g., a superstar teammate is out). Averaging over 5-10 games smooths out this variance.

## How it works (The Intuition)
Imagine you're trying to predict if a student will pass a test tomorrow.
- **Season Average (Junior Approach)**: "They've passed 70% of tests this year."
- **Rolling Stats (Senior Approach)**: "They've passed 90% of tests in the last 2 weeks."
The rolling stat tells you where the student is *now*, which is a better signal for *tomorrow*.

### The "Data Leakage" Trap
Crucially, when building rolling features for "Game X", you must only look at "Games 1 through X-1". If you include "Game X" in its own average, your model will "cheat" by knowing the result of the game it's trying to predict. This is called **Data Leakage**.

In SQL, we handle this by explicitly defining the window range:
```sql
AVG(points) OVER (
    PARTITION BY team_id 
    ORDER BY game_date
    ROWS BETWEEN 5 PRECEDING AND 1 PRECEDING -- Look back 5, stop at previous
)
```

## When to use vs. Alternatives
- **Rolling Window (Current Choice)**: Best for capturing recent form/momentum.
- **Season to Date (Cumulative)**: Best for capturing high-level team quality.
- **Exponentially Weighted Moving Average (EWMA)**: More advanced; gives more weight to the most recent games and less to older games.

## Common Interview Questions
1. **"What is data leakage and how did you prevent it in your features?"**
   - *Answer*: Data leakage occurs when info from the target variable is present in the training features. I prevented this by using a lagged window in SQL (`1 PRECEDING`), ensuring features for a game only use information available *before* tip-off.
2. **"Why did you choose 5 and 10 games for your rolling windows?"**
   - *Answer*: 5 games represents "short-term momentum" (roughly 2 weeks of play), while 10 games represents "medium-term stability" (about a month). This allows the model to differentiate between a lucky streak and a genuine improvement.
3. **"How do you handle the first 5 games of a season where the rolling window is empty?"**
   - *Answer*: This is the "Cold Start" problem. I handle this by either backfilling with the previous season's final averages or by using the cumulative season average until the window is sufficiently full.

## Senior Manager / Architect Perspective
> "Rolling features are the foundation of temporal ML. By pushing this computation into the database using window functions, we transformed a complex O(n^2) logic in Python into a highly optimized O(n log n) operation in PostgreSQL. This allows us to recompute the entire feature store in seconds, ensuring our models stay fresh without expensive overhead."

---
*Generated by the Sports Analytics Intelligence Platform*
