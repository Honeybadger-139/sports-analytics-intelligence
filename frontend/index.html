<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="NBA analytics console for raw data exploration, data quality monitoring, and model analysis.">
    <title>NBA Intelligence Console | Sports Analytics Intelligence</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=IBM+Plex+Mono:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body>
    <div class="shell">
        <header class="topbar">
            <div class="brand">
                <div class="brand-mark">NBA</div>
                <div>
                    <h1>Sports Analytics Intelligence</h1>
                    <p>Focused only on NBA analytics in the current version</p>
                </div>
            </div>
            <div class="topbar-actions">
                <button id="refresh-all-btn" class="btn">Refresh</button>
                <button id="theme-toggle-btn" class="btn btn-ghost" aria-pressed="false">Dark Mode</button>
                <div id="overall-status" class="pill pill-loading">Connecting...</div>
            </div>
        </header>

        <nav class="tabs" aria-label="Dashboard sections">
            <button class="tab-btn active" data-tab="home">Home</button>
            <button class="tab-btn" data-tab="raw">Raw Data Explorer</button>
            <button class="tab-btn" data-tab="quality">Data Quality</button>
            <button class="tab-btn" data-tab="analysis">Analysis</button>
        </nav>

        <main class="layout">
            <section id="tab-home" class="tab-panel active">
                <article class="module">
                    <div class="module-header">
                        <h2>Home</h2>
                        <span class="chip">NBA-only Scope</span>
                    </div>
                    <div class="home-hero">
                        <h3>What this dashboard does</h3>
                        <p>
                            This console helps you run an end-to-end NBA analytics workflow:
                            inspect raw Postgres data, monitor ingestion quality and API load timings,
                            and perform model + bankroll analysis in one place.
                        </p>
                    </div>
                    <div class="home-grid">
                        <div class="callout">
                            <strong>Tab 1 路 Raw Data Explorer</strong><br>
                            Browse all raw tables (`matches`, `teams`, `players`, `team_game_stats`, `player_game_stats`, `player_season_stats`).
                            Feature tables are intentionally excluded.
                        </div>
                        <div class="callout">
                            <strong>Tab 2 路 Data Quality</strong><br>
                            Track row counts, ingestion/feature load times, quality checks, and team performance indicators.
                        </div>
                        <div class="callout">
                            <strong>Tab 3 路 Analysis</strong><br>
                            Use prediction, deep-dive explainability, model performance, and bankroll modules for your own analysis.
                        </div>
                    </div>
                </article>
            </section>

            <section id="tab-raw" class="tab-panel">
                <article class="module">
                    <div class="module-header">
                        <h2>Raw Data Explorer</h2>
                        <div class="module-actions">
                            <button id="raw-refresh-btn" class="btn btn-ghost">Refresh Tables</button>
                        </div>
                    </div>
                    <div class="controls">
                        <select id="raw-table-select"></select>
                        <input id="raw-season-input" type="text" value="2025-26" placeholder="Season (e.g., 2025-26)">
                        <input id="raw-limit-input" type="number" min="10" max="300" value="50">
                        <button id="raw-load-btn" class="btn">Load</button>
                    </div>
                    <div class="controls">
                        <button id="raw-prev-btn" class="btn btn-ghost">Prev</button>
                        <button id="raw-next-btn" class="btn btn-ghost">Next</button>
                        <span id="raw-meta" class="chip">Rows 0-0 of 0</span>
                    </div>
                    <div class="table-wrap">
                        <table>
                            <thead id="raw-head"></thead>
                            <tbody id="raw-body">
                                <tr><td class="empty">Loading raw table metadata...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </article>
            </section>

            <section id="tab-quality" class="tab-panel">
                <article class="module">
                    <div class="module-header">
                        <h2>Data Quality & Pipeline Monitoring</h2>
                        <button id="quality-refresh-btn" class="btn btn-ghost">Refresh</button>
                    </div>
                    <div class="controls">
                        <input id="quality-season-input" type="text" value="2025-26" placeholder="Season">
                        <button id="quality-load-btn" class="btn">Load Season Metrics</button>
                    </div>
                    <section class="summary-grid">
                        <div><span>Matches</span><strong id="q-matches">0</strong></div>
                        <div><span>Teams</span><strong id="q-teams">0</strong></div>
                        <div><span>Active Players</span><strong id="q-players">0</strong></div>
                        <div><span>Team Stat Rows</span><strong id="q-team-stats">0</strong></div>
                        <div><span>Player Stat Rows</span><strong id="q-player-stats">0</strong></div>
                        <div><span>Avg Ingestion Time</span><strong id="q-avg-ingest">--</strong></div>
                        <div><span>Avg Feature Time</span><strong id="q-avg-feature">--</strong></div>
                        <div><span>Latest Ingestion</span><strong id="q-latest-ingest">--</strong></div>
                        <div><span>Latest Feature</span><strong id="q-latest-feature">--</strong></div>
                    </section>
                </article>

                <section class="split">
                    <article class="module">
                        <div class="module-header">
                            <h2>Quality Checks</h2>
                        </div>
                        <div class="table-wrap compact">
                            <table>
                                <thead>
                                    <tr><th>Check</th><th>Value</th></tr>
                                </thead>
                                <tbody id="quality-check-body">
                                    <tr><td colspan="2" class="empty">No quality checks loaded.</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </article>
                    <article class="module">
                        <div class="module-header">
                            <h2>Top Team Performance</h2>
                        </div>
                        <div class="table-wrap compact">
                            <table>
                                <thead>
                                    <tr><th>Team</th><th>W</th><th>L</th><th>Win %</th></tr>
                                </thead>
                                <tbody id="quality-team-body">
                                    <tr><td colspan="4" class="empty">No team metrics loaded.</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </article>
                </section>

                <article class="module">
                    <div class="module-header">
                        <h2>Recent Pipeline Runs</h2>
                    </div>
                    <div class="table-wrap">
                        <table>
                            <thead>
                                <tr>
                                    <th>Timestamp</th>
                                    <th>Module</th>
                                    <th>Status</th>
                                    <th>Processed</th>
                                    <th>Inserted</th>
                                    <th>Elapsed (s)</th>
                                    <th>Errors</th>
                                </tr>
                            </thead>
                            <tbody id="quality-run-body">
                                <tr><td colspan="7" class="empty">No run history loaded.</td></tr>
                            </tbody>
                        </table>
                    </div>
                </article>
            </section>

            <section id="tab-analysis" class="tab-panel">
                <section class="stats-grid">
                    <article class="panel">
                        <h3>Database</h3>
                        <div id="db-status" class="metric">--</div>
                        <p class="meta">PostgreSQL connectivity</p>
                    </article>
                    <article class="panel">
                        <h3>Pipeline</h3>
                        <div id="pipeline-status" class="metric">--</div>
                        <p id="last-sync" class="meta">Last sync: --</p>
                    </article>
                    <article class="panel">
                        <h3>Matches</h3>
                        <div id="match-count" class="metric mono">0</div>
                        <p class="meta">Current season records</p>
                    </article>
                    <article class="panel">
                        <h3>Features</h3>
                        <div id="feature-count" class="metric mono">0</div>
                        <p class="meta">Feature rows available</p>
                    </article>
                    <article class="panel">
                        <h3>Players</h3>
                        <div id="player-count" class="metric mono">0</div>
                        <p class="meta">Active player entries</p>
                    </article>
                    <article class="panel">
                        <h3>Bankroll</h3>
                        <div id="bankroll-value" class="metric mono">$0.00</div>
                        <p class="meta">Current tracked capital</p>
                    </article>
                    <article class="panel">
                        <h3>ROI</h3>
                        <div id="roi-value" class="metric mono">0.00%</div>
                        <p class="meta">Settled bet return</p>
                    </article>
                    <article class="panel">
                        <h3>Open Bets</h3>
                        <div id="open-bets-value" class="metric mono">0</div>
                        <p class="meta">Pending settlements</p>
                    </article>
                </section>

                <section class="module">
                    <div class="module-header">
                        <h2>Today's Predictions</h2>
                        <div class="module-actions">
                            <span id="today-date" class="chip">Date: --</span>
                            <button id="refresh-today-btn" class="btn btn-ghost">Refresh</button>
                        </div>
                    </div>
                    <div class="table-wrap">
                        <table>
                            <thead>
                                <tr>
                                    <th>Game ID</th>
                                    <th>Matchup</th>
                                    <th>Consensus</th>
                                    <th>Home Win %</th>
                                    <th>Confidence</th>
                                </tr>
                            </thead>
                            <tbody id="today-body">
                                <tr><td colspan="5" class="empty">Loading today's predictions...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <section class="split">
                    <article class="module">
                        <div class="module-header">
                            <h2>Match Deep Dive</h2>
                        </div>
                        <div class="controls">
                            <select id="deep-dive-select"></select>
                            <button id="deep-dive-load-btn" class="btn">Load</button>
                        </div>
                        <div id="deep-dive-overview" class="callout">
                            Select a game to inspect prediction details and top SHAP factors.
                        </div>
                        <h4>Top SHAP Factors</h4>
                        <div class="table-wrap compact">
                            <table>
                                <thead>
                                    <tr><th>Factor</th><th>Impact</th><th>Direction</th></tr>
                                </thead>
                                <tbody id="shap-body">
                                    <tr><td colspan="3" class="empty">No explanation loaded.</td></tr>
                                </tbody>
                            </table>
                        </div>
                        <h4>Feature Snapshot</h4>
                        <div class="table-wrap compact">
                            <table>
                                <thead>
                                    <tr><th>Team</th><th>5-Game Win %</th><th>5-Game Margin</th><th>Rest</th><th>Streak</th></tr>
                                </thead>
                                <tbody id="feature-body">
                                    <tr><td colspan="5" class="empty">No feature snapshot loaded.</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </article>

                    <article class="module">
                        <div class="module-header">
                            <h2>Model Performance</h2>
                            <span class="chip">Season: 2025-26</span>
                        </div>
                        <div class="table-wrap">
                            <table>
                                <thead>
                                    <tr><th>Model</th><th>Games</th><th>Accuracy</th><th>Brier</th><th>Avg Confidence</th></tr>
                                </thead>
                                <tbody id="performance-body">
                                    <tr><td colspan="5" class="empty">Loading performance metrics...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </article>
                </section>

                <section class="split">
                    <article class="module">
                        <div class="module-header">
                            <h2>Bankroll Tracker</h2>
                            <button id="refresh-bankroll-btn" class="btn btn-ghost">Refresh</button>
                        </div>
                        <div class="summary-grid">
                            <div><span>Season</span><strong id="summary-season">--</strong></div>
                            <div><span>Total Bets</span><strong id="summary-total-bets">0</strong></div>
                            <div><span>Settled</span><strong id="summary-settled-bets">0</strong></div>
                            <div><span>Total Stake</span><strong id="summary-total-stake">$0.00</strong></div>
                            <div><span>Total PnL</span><strong id="summary-total-pnl">$0.00</strong></div>
                            <div><span>Bankroll</span><strong id="summary-bankroll">$0.00</strong></div>
                            <div><span>ROI</span><strong id="summary-roi">0.00%</strong></div>
                        </div>
                    </article>
                    <article class="module">
                        <div class="module-header">
                            <h2>Recent Bets</h2>
                        </div>
                        <div class="table-wrap">
                            <table>
                                <thead>
                                    <tr><th>ID</th><th>Matchup</th><th>Selection</th><th>Stake</th><th>Result</th><th>PnL</th></tr>
                                </thead>
                                <tbody id="bets-body">
                                    <tr><td colspan="6" class="empty">Loading bet history...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </article>
                </section>

                <section class="module">
                    <div class="module-header">
                        <h2>Pipeline Audit History</h2>
                        <button id="refresh-audit-btn" class="btn btn-ghost">Refresh</button>
                    </div>
                    <div class="table-wrap">
                        <table>
                            <thead>
                                <tr><th>Timestamp</th><th>Module</th><th>Status</th><th>Processed</th><th>Inserted</th><th>Elapsed</th><th>Errors</th></tr>
                            </thead>
                            <tbody id="audit-body">
                                <tr><td colspan="7" class="empty">Loading pipeline audit...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </section>
            </section>
        </main>

        <footer>
            <p>Sports Analytics Intelligence Platform 路 NBA Analytics Console</p>
        </footer>
    </div>

    <script src="js/dashboard.js"></script>
</body>
</html>
